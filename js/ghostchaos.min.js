function getRandom(b,a){if(b>a){return -1}if(b==a){return b}return b+parseInt(Math.random()*(a-b+1))}function trunc(a){return(a|0)}var iOS=false,iPad=false,iPhone=false,iPod=false,mobile=false,contentScale=false,difficulty=0,frameRate=60,canvasPosX=0,canvasPosY=0,ghost=[],timeleft=0,ghostsleft=0,maxGhosts=0,radius=0,gameOver=false,nextLevel=false,highQuality=true,timeSetter,updateSetter,animateSetter,bgMusic,booSound;DisplayOrientation={Landscape:0,Portrait:1};objGhost=function(){var b;this.dead=false;b=new SmokeMonster.Sprite(document.getElementById("game"));b.loadFromFile("img/ghost.png",new SmokeMonster.Rect(0,0,45,45));$(b.node).css("left",getRandom(23,460-23));$(b.node).css("top",getRandom(23,320-23));b.position.z=7;b.className="objGhost";b.addAnimation("alpha",100,"ease-out",0);b.position.x=getRandom(23,460-23);b.position.y=getRandom(23,320-23);b.offset.position.x=(45/2);b.offset.position.y=(45/2);b.alpha=255;b.mousedown(function(){if(!this.dead){b.alpha=0;timeleft=timeleft-1.5;updateTimeOverlay()}});b.visible=false;this.frame=0;this.frameRow=0;this.sprite=b;this.velocity=new SmokeMonster.Vector(0,0);this.rotateStep=getRandom(0,100)/100;var a=function(){var d=getRandom(0,100),c=getRandom(0,100);if(d>50){this.velocity.x=this.velocity.x*(-1)}if(c>50){this.velocity.y=this.velocity.y*(-1)}};this.setRandomMovement=a};Game=function(){var h=0,e=0,i=0,k,l=0,c=460,f=320,a=function(){if(trunc($(window).width()/$(window).height())>=1){l=0}else{l=1}var o=$(window).width()/c,n=$(window).height()/f;if(o<n){i=o}else{i=n}if(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/Bada/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/iPad/i)){mobile=true;contentScale=true;if((navigator.userAgent.match(/iPhone/i))||(navigator.userAgent.match(/iPod/i))||(navigator.userAgent.match(/iPad/i))){if(navigator.userAgent.match(/iPhone/i)){iPhone=true}if(navigator.userAgent.match(/iPod/i)){iPod=true}if(navigator.userAgent.match(/iPad/i)){iPad=true}iOS=true}}canvasPosX=($(window).width()-$("#content").width())/2;canvasPosY=($(window).height()-$("#content").height())/2;if(contentScale){var m;if(i<1){m=0.05}else{m=0.15}if(mobile){if(i>1.4){i=1.4}}document.getElementById("content").style.transform="scale("+(i-m)+")";document.getElementById("content").style.webkitTransform="scale("+(i-m)+")";document.getElementById("content").style.mozTransform="scale("+(i-m)+")"}},g=function(){$(document).ready(function(){$("body").width($(window).width());$("body").height($(window).height());$("div#content").width(c);$("div#content").height(f);$("div.gameState").width(c);$("div#loading").width(c);$("div#loading").height(f);$("div.blackrect").width(c);$("div.blackrect").height(f);$("div#mouserect").width(c);$("div#mouserect").height(f);if(Modernizr.localstorage){if((typeof(localStorage["GhostChaos.Config.Scale"])!="undefined")&&(localStorage["GhostChaos.Config.Scale"]!=null)&&(localStorage["GhostChaos.Config.Scale"]!="")){contentScale=localStorage["GhostChaos.Config.Scale"];updateScaleLabel();Game.resize()}if((typeof(localStorage["GhostChaos.Config.HighQuality"])!=="undefined")&&(localStorage["GhostChaos.Config.HighQuality"]!=null)&&(localStorage["GhostChaos.Config.HighQuality"]!="")){setQuality(localStorage["GhostChaos.Config.HighQuality"])}}});a();k=new SmokeMonster.Sprite(document.getElementById("game"));k.loadFromFile("img/holes.png");k.offset.position.x=128;k.offset.position.y=128;h=($("#game").width()-k.width)/2;e=($("#game").height()-k.height)/2;k.position.z=3;$("#mouserect").mousemove(function(n){h=n.pageX-canvasPosX;e=n.pageY-canvasPosY});$("body").mousemove(function(n){h=n.pageX-canvasPosX;e=n.pageY-canvasPosY});function m(n){n.preventDefault();var o=event.touches[0];h=(o.pageX-canvasPosX);e=(o.pageY-canvasPosY)}if(Modernizr.touch||mobile){document.getElementById("mouserect").addEventListener("touchmove",m,false);document.body.addEventListener("touchmove",m,false);$("#btnScale").hide()}$("#overlayPause").click(function(){switchGameState("pauselevel")})},b=function(m){if(highQuality){$(".blackrect").css("opacity",0.75);k.alpha=192}else{$(".blackrect").css("opacity",1);k.alpha=255}k.clipRect.make(256*m,0,256,256)},j=function(){for(var m=0;m<ghost.length;m++){ghost[m].sprite.draw()}k.position.x=h;k.position.y=e;$("div#left.blackrect").css("clip","rect({0}px, {1}px, {2}px, {3}px)".format(0,h-128,f,0));$("div#right.blackrect").css("clip","rect({0}px, {1}px, {2}px, {3}px)".format(0,c,f,h+128));$("div#top.blackrect").css("clip","rect({0}px, {1}px, {2}px, {3}px)".format(0,h+128,e-128,h-128));$("div#bottom.blackrect").css("clip","rect({0}px, {1}px, {2}px, {3}px)".format(e+128,h+128,f,h-128));k.draw()},d=function(){for(var o=0;o<ghost.length;o++){ghost[o].sprite.position.x+=ghost[o].velocity.x;ghost[o].sprite.position.y+=ghost[o].velocity.y;ghost[o].sprite.angle+=ghost[o].rotateStep;if(ghost[o].sprite.angle>=360){ghost[o].sprite.rotation=0}if((ghost[o].sprite.position.x<=(45/2))||(ghost[o].sprite.position.x>=(460-(45/2)))){ghost[o].velocity.x=ghost[o].velocity.x*(-1)}if((ghost[o].sprite.position.y<=(45/2))||(ghost[o].sprite.position.y>=(320-(45/2)))){ghost[o].velocity.y=ghost[o].velocity.y*(-1)}var n=Math.abs(ghost[o].sprite.position.x-h),m=Math.abs(ghost[o].sprite.position.y-e),p=Math.sqrt(n*n+m*m);if(p<radius){if(!ghost[o].dead){ghost[o].sprite.visible=true;if(ghost[o].sprite.alpha>0){ghost[o].sprite.alpha--}else{ghost[o].dead=true;ghostsleft--;if(typeof(booSound)!="undefined"){booSound.play()}}}else{ghost[o].sprite.visible=false}}else{ghost[o].sprite.visible=false;if(!ghost[o].dead){ghost[o].sprite.alpha=255}}}if(timeleft<=0){gameOver=true}if(ghostsleft<=0){nextLevel=true}if(gameOver){switchGameState("gameover")}if(nextLevel){switchGameState("nextlevel")}$("#overlayGhosts").html("x "+ghostsleft)};return{width:c,height:f,displayOrientation:l,resize:a,initialize:g,updateHole:b,draw:j,update:d}}();Achievements=function(){var e={},c,a=function(f){c=f;if(Modernizr.localstorage){if((typeof(localStorage[c])!="undefined")&&(localStorage[c]!=null)&&(localStorage[c]!="")){e=jQuery.parseJSON(localStorage[c])}}},d=function(h,g,f){e[h]={active:false};if(typeof(g)!=="undefined"){e[h]["description"]=g}if(typeof(f)!=="undefined"){e[h]["icon"]=f}},b=function(){var g=0;for(var f in e){g++}return g};getUnlockedCount=function(){var g=0;for(var f in e){if(e[f]["active"]){g++}}return g};list=function(){var f="";for(var g in e){if(e[g]["active"]){f+='<div class="ach_box unlocked"><span class="ach_unlocked">'+g+'</span><br /><span class="ach_details">'+e[g]["description"]+"</span></div><br /><br />"}else{f+='<div class="ach_box locked"><span class="ach_locked">'+g+'</span><br /><span class="ach_details">'+e[g]["description"]+"</span></div><br /><br />"}}return f};show=function(f){if(e[f]==="undefined"){d(f)}if(!e[f]["active"]){if((typeof(e[f].icon)!="undefined")&&(e[f].icon!="")){$("#achievement_box").css("background-image","url("+e[f].icon+")")}$("#ach_text").html(f);$("#achievement_box").css({opacity:0});$("#achievement_box").animate({opacity:1,bottom:"8px"},750);setTimeout(function(){$("#achievement_box").animate({opacity:0,bottom:"-80px"},750)},2500);e[f].active=true}if(Modernizr.localstorage){localStorage[c]=JSON.stringify(e)}};return{initialize:a,getCount:b,getUnlockedCount:getUnlockedCount,list:list,register:d,show:show}}();function animateGhosts(){if(!highQuality){return}for(var a=0;a<ghost.length;a++){ghost[a].frame++;if(ghost[a].frame==20){ghost[a].frame=0;if(ghost[a].frameRow==1){ghost[a].frameRow=0}else{ghost[a].frameRow++}}ghost[a].sprite.clipRect.make(45*ghost[a].frame,45*ghost[a].frameRow,45,45)}}function setQuality(a){highQuality=a;if(highQuality){if($("#content").hasClass("lowQuality")){$("#content").removeClass("lowQuality")}if($("#mouseover_box").hasClass("lowQuality")){$("#mouseover_box").removeClass("lowQuality")}if($("#achievement_box").hasClass("lowQuality")){$("#achievement_box").removeClass("lowQuality")}if($(".buttonQuality").hasClass("lowQuality")){$(".buttonQuality").removeClass("lowQuality")}if($(".overlay").hasClass("lowQuality")){$(".overlay").removeClass("lowQuality")}if($("span").hasClass("lowQuality")){$("span").removeClass("lowQuality")}document.getElementById("btnLowQuality").style.backgroundColor="#000";document.getElementById("btnHighQuality").style.backgroundColor="#aaaa00"}else{$("#content").addClass("lowQuality");$("#mouseover_box").addClass("lowQuality");$("#achievement_box").addClass("lowQuality");$(".buttonQuality").addClass("lowQuality");$(".overlay").addClass("lowQuality");$("span").addClass("lowQuality");document.getElementById("btnLowQuality").style.backgroundColor="#aaaa00";document.getElementById("btnHighQuality").style.backgroundColor="#000"}if(Modernizr.localStorage){localStorage["GhostChaos.Config.HighQuality"]=highQuality}}function onBtnLowQualityOver(){$("#mouseover_box").css("opacity",1);$("#mouseover_text").html("Low Quality");if(!highQuality){document.getElementById("btnLowQuality").style.backgroundColor="#888800"}else{document.getElementById("btnLowQuality").style.backgroundColor="#444400"}}function onBtnLowQualityOut(){$("#mouseover_box").css("opacity",0);if(highQuality){document.getElementById("btnLowQuality").style.backgroundColor="#000"}else{document.getElementById("btnLowQuality").style.backgroundColor="#aaaa00"}}function onBtnHighQualityOver(){$("#mouseover_box").css("opacity",1);$("#mouseover_text").html("High Quality");if(highQuality){document.getElementById("btnHighQuality").style.backgroundColor="#888800"}else{document.getElementById("btnHighQuality").style.backgroundColor="#444400"}}function onBtnHighQualityOut(){$("#mouseover_box").css("opacity",0);if(highQuality){document.getElementById("btnHighQuality").style.backgroundColor="#aaaa00"}else{document.getElementById("btnHighQuality").style.backgroundColor="#000"}}function switchScale(){contentScale=!contentScale;if(Modernizr.localstorage){localStorage["GhostChaos.Config.Scale"]=contentScale}updateScaleLabel();Game.resize()}function onBtnAchUp(){$("#ach_list").scrollTop($("#ach_list").scrollTop()-40)}function onBtnAchDown(){$("#ach_list").scrollTop($("#ach_list").scrollTop()+40)}function updateScaleLabel(){if(contentScale){$("#btnScale").html('<a href="javascript:void(0)" onclick="switchScale()" style="font-size: 70%">Scale: On</a>')}else{$("#btnScale").html('<a href="javascript:void(0)" onclick="switchScale()" style="font-size: 70%">Scale: Off</a>');document.getElementById("content").style.webkitTransform="scale(1.0)"}}function init(){if(iOS){window.top.scrollTo(0,1)}$("#mouseover_box").css("opacity",0);Achievements.register("Who you gonna call?","Master level 1 on an easy difficulty setting");Achievements.register("OMG! Double Ghost all the way!","Master level 1 on a normal difficulty setting");Achievements.register("Good Ghost Hunting","Master level 1 on a hard difficulty setting");Achievements.register("Those things are getting fast","Master level 7 on an easy difficulty setting");Achievements.register("I see dead... err... ghosts","Master level 7 on a normal difficulty setting");Achievements.register("Anyone got a better light?","Master level 7 on a hard difficulty setting");Achievements.register("Ghost Apocalypse","Master level 21 on an easy difficulty setting");Achievements.register("Getting the hang of this","Master level 21 on a normal difficulty setting");Achievements.register("Mission Impossible","Master level 21 on  a hard difficulty setting");Achievements.register("Someone made this game?","View credits screen");Achievements.initialize("GhostChaos.Achievements");Game.initialize();switchGameState("loading");if(!bgMusic){bgMusic=document.getElementById("music")}if(bgMusic){bgMusic.addEventListener("ended",function(){this.currentTime=0},false);bgMusic.play()}if(!booSound){booSound=document.getElementById("boo")}switchGameState("mainmenu")}if(window.addEventListener){window.addEventListener("resize",function(a){Game.resize()},false)}else{if(window.attachEvent){window.attachEvent("onresize",function(a){Game.resize()})}}if(mobile){body.onorientationchange=function(){Game.resize()}}function switchGameState(a){$(".gameState").hide();$("#"+a).show();if(a=="credits"){Achievements.show("Someone made this game?")}if((a=="gameover")||(a=="nextlevel")||(a=="pauselevel")){clearInterval(updateSetter);clearInterval(timeSetter);clearInterval(animateGhosts);if(a=="nextlevel"){var b="";switch(difficulty){case 0:b="Easy";switch(maxGhost-1){case 1:Achievements.show("Who you gonna call?");break;case 7:Achievements.show("Those things are getting fast");break;case 21:Achievements.show("Ghost Apocalypse");break}break;case 1:b="Normal";switch(maxGhost-1){case 1:Achievements.show("OMG! Double Ghost all the way!");break;case 7:Achievements.show("I see dead... err... ghosts");break;case 21:Achievements.show("Getting the hang of this");break}break;case 2:b="Hard";switch(maxGhost-1){case 1:Achievements.show("Good Ghost Hunting");break;case 7:Achievements.show("Anyone got a better light?");break;case 21:Achievements.show("Mission Impossible");break}break}$("#congratz").html("You mastered Level "+(maxGhost-1)+" ("+b+").")}}if(a=="achievements"){$("#ach_state").html("{0} / {1} Achievements unlocked".format(Achievements.getUnlockedCount(),Achievements.getCount()));$("#ach_list").html(Achievements.list())}}function resumeGame(){switchGameState("game");timeSetter=setInterval(timeCount,1000);updateSetter=setInterval(update,frameRate/1000);animateSetter=setInterval(animateGhosts,250)}function updateTimeOverlay(){$("#overlayTime").html(function(){var a,b;if(Math.floor(timeleft/60)<10){a="0"+trunc(timeleft/60)}else{a=""+trunc(timeleft/60)}if(Math.floor(timeleft%60)<10){b="0"+trunc(timeleft%60)}else{b=""+trunc(timeleft%60)}return a+":"+b})}function timeCount(){timeleft--;updateTimeOverlay()}function startGame(a,b){gameOver=false;nextLevel=false;difficulty=a;ghostsleft=b;maxGhost=b;var d=(6-(a*1.25))*b;timeleft=Math.round(Math.sqrt(d)*Math.log(d));updateTimeOverlay();switchGameState("game");Game.updateHole(difficulty);radius=128-(a*32)-23;for(var c=0;c<ghost.length;c++){ghost[c].sprite.remove()}ghost.splice(0,ghost.length);ghost[b-1]=0;for(var c=0;c<ghost.length;c++){ghost[c]=new objGhost();ghost[c].velocity.x=0.1*(a+1)*(c+1);ghost[c].velocity.y=0.1*(a+1)*(c+1);ghost[c].setRandomMovement()}timeSetter=setInterval(timeCount,1000);updateSetter=setInterval(update,frameRate/1000);animateSetter=setInterval(animateGhosts,250)}function incStartGame(){maxGhost++;var a=maxGhost++;startGame(difficulty,a)}function update(){Game.draw();Game.update()};