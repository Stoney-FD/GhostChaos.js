function getRandom(b,a){if(b>a){return(-1)}if(b==a){return(b)}return(b+parseInt(Math.random()*(a-b+1)))}function trunc(a){return(a|0)}var iOS=false,iPad=false,iPhone=false,iPod=false,mobile=false,difficulty=0,frameRate=60,canvasPosX=0,canvasPosY=0,ghost=new Array(),timeleft=0,ghostsleft=0,maxGhosts=0,radius=0,gameOver=false,nextLevel=false,timeSetter,updateSetter,animateSetter,booSound;if(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/iPad/i)){mobile=true;if((navigator.userAgent.match(/iPhone/i))||(navigator.userAgent.match(/iPod/i))||(navigator.userAgent.match(/iPad/i))){if(navigator.userAgent.match(/iPhone/i)){iPhone=true}if(navigator.userAgent.match(/iPod/i)){iPod=true}if(navigator.userAgent.match(/iPad/i)){iPad=true;document.getElementById("view").setAttribute("content","width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=no;")}iOS=true}}objGhost=function(){var b;this.dead=false;b=new SmokeMonster.Sprite(document.getElementById("game"));b.loadFromFile("img/ghost.png",new SmokeMonster.Rect(0,0,45,45));$(b.node).css("left",getRandom(23,460-23));$(b.node).css("top",getRandom(23,320-23));b.position.z=7;b.className="objGhost";b.addAnimation("alpha",100,"ease-out",0);b.position.x=getRandom(23,460-23);b.position.y=getRandom(23,320-23);b.offset.position.x=(45/2);b.offset.position.y=(45/2);b.alpha=255;b.mousedown(function(){if(!this.dead){b.alpha=0;timeleft=timeleft-1.5;updateTimeOverlay()}});b.visible=false;this.frame=0;this.frameRow=0;this.sprite=b;this.velocity=new SmokeMonster.Vector(0,0);this.rotateStep=getRandom(0,100)/100;var a=function(){var d=getRandom(0,100),c=getRandom(0,100);if(d>50){this.velocity.x=this.velocity.x*(-1)}if(c>50){this.velocity.y=this.velocity.y*(-1)}};this.setRandomMovement=a};var Game=new function(){this.hole;var g=0,e=0,a=460,c=320,d=function(){this.hole=new SmokeMonster.Sprite(document.getElementById("game"));this.hole.loadFromFile("img/holes.png");this.hole.alpha=192;this.hole.offset.position.x=128;this.hole.offset.position.y=128;g=($("#game").width()-this.hole.width)/2;e=($("#game").height()-this.hole.height)/2;this.hole.position.z=3;$("#mouserect").mousemove(function(){g=(SmokeMonster.Cursor.x-canvasPosX);e=(SmokeMonster.Cursor.y-canvasPosY)});$("body").mousemove(function(){g=(SmokeMonster.Cursor.x-canvasPosX);e=(SmokeMonster.Cursor.y-canvasPosY)});function h(i){i.preventDefault();var j=event.touches[0];g=(j.pageX-canvasPosX);e=(j.pageY-canvasPosY)}if(Modernizr.touch||mobile){document.getElementById("mouserect").addEventListener("touchmove",h,false);document.body.addEventListener("touchmove",h,false)}$("#overlayPause").click(function(){switchGameState("pauselevel")})},f=function(){for(var h=0;h<ghost.length;h++){ghost[h].sprite.draw()}this.hole.position.x=g;this.hole.position.y=e;$("div#left.blackrect").width(g-128);$("div#right.blackrect").css("left",g+128);$("div#right.blackrect").width(a-g-127);$("div#top.blackrect").css("left",g-128);$("div#top.blackrect").height(e-128);$("div#bottom.blackrect").css("left",g-128);$("div#bottom.blackrect").css("top",e+128);$("div#bottom.blackrect").height(c-e-127);this.hole.draw()},b=function(){for(var k=0;k<ghost.length;k++){ghost[k].sprite.position.x+=ghost[k].velocity.x;ghost[k].sprite.position.y+=ghost[k].velocity.y;ghost[k].sprite.angle+=ghost[k].rotateStep;if(ghost[k].sprite.angle>=360){ghost[k].sprite.rotation=0}if((ghost[k].sprite.position.x<=(45/2))||(ghost[k].sprite.position.x>=(460-(45/2)))){ghost[k].velocity.x=ghost[k].velocity.x*(-1)}if((ghost[k].sprite.position.y<=(45/2))||(ghost[k].sprite.position.y>=(320-(45/2)))){ghost[k].velocity.y=ghost[k].velocity.y*(-1)}var j=Math.abs(ghost[k].sprite.position.x-g),h=Math.abs(ghost[k].sprite.position.y-e),l=Math.sqrt(j*j+h*h);if(l<radius){if(!ghost[k].dead){ghost[k].sprite.visible=true;if(ghost[k].sprite.alpha>0){ghost[k].sprite.alpha--}else{ghost[k].dead=true;ghostsleft--;booSound.play()}}else{ghost[k].sprite.visible=false}}else{ghost[k].sprite.visible=false;if(!ghost[k].dead){ghost[k].sprite.alpha=255}}}if(timeleft<=0){gameOver=true}if(ghostsleft<=0){nextLevel=true}if(gameOver){switchGameState("gameover")}if(nextLevel){switchGameState("nextlevel")}$("#overlayGhosts").html("x "+ghostsleft);if(g<=128){$("div#left.blackrect").hide()}else{$("div#left.blackrect").show()}if(e<=128){$("div#top.blackrect").hide()}else{$("div#top.blackrect").show()}if(g>=(480-128)){$("div#right.blackrect").hide()}else{$("div#right.blackrect").show()}if(e>=(360-128)){$("div#bottom.blackrect").hide()}else{$("div#bottom.blackrect").show()}};this.initialize=d;this.draw=f;this.update=b;this.width=a;this.height=c};function animateGhosts(){for(var a=0;a<ghost.length;a++){ghost[a].frame++;if(ghost[a].frame==20){ghost[a].frame=0;if(ghost[a].frameRow==1){ghost[a].frameRow=0}else{ghost[a].frameRow++}}ghost[a].sprite.clipRect.make(45*ghost[a].frame,45*ghost[a].frameRow,45,45)}}function setCanvasPos(){canvasPosX=($(document).width()-$("#content").width())/2;canvasPosY=($(document).height()-$("#content").height())/2;$("#content").css("left",canvasPosX);$("#content").css("top",canvasPosY)}function init(){switchGameState("loading");if(iOS){window.top.scrollTo(0,1)}soundManager.url="";soundManager.useHTML5Audio=true;soundManager.useFlashBlock=false;soundManager.debugMode=false;soundManager.onready(function(a){if(a.success){var b=soundManager.createSound({id:"music",url:"sounds/music.mp3",loop:"infinite"});b.play();booSound=soundManager.createSound({id:"boo",url:"sounds/boo.wav"})}});setCanvasPos();Game.initialize();switchGameState("mainmenu")}if(window.addEventListener){window.addEventListener("resize",function(a){setCanvasPos()},false)}else{if(window.attachEvent){window.attachEvent("onresize",function(a){setCanvasPos()})}}function switchGameState(a){$(".gameState").hide();$("#"+a).show();if((a=="gameover")||(a=="nextlevel")||(a=="pauselevel")){clearInterval(updateSetter);clearInterval(timeSetter);clearInterval(animateGhosts);if(a=="nextlevel"){var b="";switch(difficulty){case 0:b="Easy";break;case 1:b="Normal";break;case 2:b="Hard";break}$("#congratz").html("You mastered Level "+(maxGhost-1)+" ("+b+").")}}}function resumeGame(){switchGameState("game");timeSetter=setInterval(timeCount,1000);updateSetter=setInterval(update,frameRate/1000);animateSetter=setInterval(animateGhosts,250)}function updateTimeOverlay(){$("#overlayTime").html(function(){var a,b;if(Math.floor(timeleft/60)<10){a="0"+trunc(timeleft/60)}else{a=""+trunc(timeleft/60)}if(Math.floor(timeleft%60)<10){b="0"+trunc(timeleft%60)}else{b=""+trunc(timeleft%60)}return a+":"+b})}function timeCount(){timeleft--;updateTimeOverlay()}function startGame(a,b){gameOver=false;nextLevel=false;difficulty=a;ghostsleft=b;maxGhost=b;var d=(6-(a*1.25))*b;timeleft=Math.round(Math.sqrt(d)*Math.log(d));updateTimeOverlay();switchGameState("game");Game.hole.clipRect.make(256*difficulty,0,256,256);radius=128-(a*32)-23;for(var c=0;c<ghost.length;c++){ghost[c].sprite.remove()}ghost.splice(0,ghost.length);ghost[b-1]=0;for(var c=0;c<ghost.length;c++){ghost[c]=new objGhost();ghost[c].velocity.x=0.1*(a+1)*(c+1);ghost[c].velocity.y=0.1*(a+1)*(c+1);ghost[c].setRandomMovement()}timeSetter=setInterval(timeCount,1000);updateSetter=setInterval(update,frameRate/1000);animateSetter=setInterval(animateGhosts,250)}function incStartGame(){maxGhost++;var a=maxGhost++;startGame(difficulty,a)}function update(){Game.draw();Game.update()};